# DX25

Implementation of DX25 - a decentralized exchange for MultiverseX blockchain platform.

## Project structure

Project structure has standard MultiverseX smart-contract layout. `mxpy` uses platform-specific code to build the contract. See [SC build reference](https://docs.multiversx.com/developers/developer-reference/sc-build-reference/) for further details.

| Directory | Purpose                                              |
| --------- | ---------------------------------------------------- |
| `mandos`  | A directory containing test scenarions for Mandos VM |
| `meta`    | ABI generator crate                                  |
| `src`     | DX25 source code                                     |
| `wasm`    | Autogenerated WASM adapters crate                    |

## Usage
The easiest way to build, test, and deploy DX25 is to use `mxpy` tool from MultiverseX team. To install the tool please refer to the [installation manual](https://docs.multiversx.com/sdk-and-tools/sdk-py/installing-mxpy). See [official mxpy documentation](https://docs.multiversx.com/sdk-and-tools/sdk-py/) for usage examples.

### How to build
To build the DEX use `mxpy contract build` command. This produces WASM file at `output/dx25.wasm`. The file can be later used to test and deploy the contract.

### How to build manually
```bash
cd meta

# Build meta crate
cargo build --release ${BUILD_ARGS}
# Generate WASM crate library code
target/release/dx25-meta build
cd ../wasm
# Build WASM crate to generate WASM file
cargo build --release ${BUILD_ARGS}

# Optionally you can convert WASM to WAT and dump WASM object info:
sudo apt install wabt
wasm2wat output/dx25.wasm -o output/dx25.wat
```

### How to test
The easiest way to test the contract is to run `mxpy contract test`. The command runs Mandos tests located in the `mados` directory. Mandos is a VM implementation, which simulates MultiversX blockchain. Note: despite we do have Rust VM from MultiverseX, platform developers recommend to use Mandos, as it is the *true* blockchain implementation.
Also you can use `cargo test` to run Rust tests.

### How to deploy
Use `mxpy contract deploy` to deploy the contract. See `mxpy` documentation for how to setup the tool.

Parameters example:
```bash
mxpy contract deploy ... --arguments erd1qyu5wthldzr8wx5c9ucg8kjagg0jfs53s8nr3zpz3hypefsdd8ssycr6th 10000 0x00010002000400080010002000400080 00000000000000000500188708ec7a15bfb98fa01ac17f32af46642f835569e10139472eff6886771a982f3083da5d421f24c29181e63888228dc81ca60d69e1 ...
```

Where:
1. `erd1qyu5wthldzr8wx5c9ucg8kjagg0jfs53s8nr3zpz3hypefsdd8ssycr6th` - DEX owner address
2. `10000` - Protocol fee fraction
3. `0x00010002000400080010002000400080` - MX-encoded fee level array `[1, 2, 4, 8, 16, 32, 64, 128]`. See [serialization documentation](https://docs.multiversx.com/developers/developer-reference/serialization-format) for how to encode data
4. `0x0000000200000000000000000500188708ec7a15bfb98fa01ac17f32af46642f835569e10139472eff6886771a982f3083da5d421f24c29181e63888228dc81ca60d69e1` MX-encoded list of wEGLD wrapper contracts. Can be any size. Must contain a contract in the same shard as the DEX:
   - `0x00000002` vector size
   - `00000000000000000500188708ec7a15bfb98fa01ac17f32af46642f835569e1` first address
   - `0139472eff6886771a982f3083da5d421f24c29181e63888228dc81ca60d69e1` second address

See [documentation](https://docs.multiversx.com/developers/sc-calls-format/#converting-bech32-addresses-erd1) for how to convert `bench32` format to HEX.
